
  <!DOCTYPE html>
  <html>
    <head>
      <title>Chord.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/Domain/Chord.ts</td><td class="">100.00%</td><td class="">99%</td><td class="">884</td><td class="">884</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import Interval from &#x27;../Domain/Interval&#x27;;
import Pitch, { PitchState } from &#x27;../Domain/Pitch&#x27;;
import { Duration } from &#x27;../Domain/Duration&#x27;;

export type ChordPitchState = {
  pitch: PitchState;
  function: string;
};

class ChordPitch {
  constructor(private _pitch: Pitch = Pitch.C, private _func: ChordFunction = ChordFunction.Root) {}

  get Pitch() {
    return this._pitch;
  }

  get Function() {
    return this._func;
  }

  get To(): Readonly&lt;ChordPitchState&gt; {
    return {
      pitch: this._pitch.To,
      function: this._func.To,
    };
  }
}

class ChordPitches {
  private _pitches: Array&lt;ChordPitch&gt; = [];

  constructor(root: Pitch, pattern: ChordPattern) {
    this._pitches = pattern.pitches(root);
  }

  get Pitches(): Pitch[] {
    return this._pitches.map((p) =&gt; p.Pitch);
  }

  get Bass(): Pitch {
    return this.first();
  }

  get Lead(): Pitch {
    return this.last();
  }

  pitchForFunction(func: ChordFunction): Pitch {
    const chordPitch = this._pitches.find((p) =&gt; p.Function === func);
    return chordPitch === undefined ? this.first() : chordPitch.Pitch;
  }

  get To(): Readonly&lt;ChordPitchState[]&gt; {
    return this._pitches.map((p) =&gt; p.To);
  }

  private first(): Pitch {
    const pitch = this._pitches[0];
    if (!pitch) {
      throw Error(&#x27;pitch should not be null/undefined&#x27;);
    }

    return pitch.Pitch;
  }

  private last(): Pitch {
    const pitch = this._pitches.slice(-1)[0];
    if (!pitch) {
      throw Error(&#x27;pitch should not be null/undefined&#x27;);
    }

    return pitch.Pitch;
  }

  // remove(func: ChordFunction) {
  //   this._pitches = this._pitches.filter((p) =&gt; p.Function != func);
  // }

  // rotate(amount = 1) {
  //   this._pitches = this._pitches.slice(amount).concat(this._pitches.slice(0, amount));
  // }
}

interface Chord {
  get Pitches(): Pitch[];
  get Bass(): Pitch;
  get Lead(): Pitch;
  get Name(): string;
  pitchForFunction(func: ChordFunction): Pitch;
  //   remove(func: ChordFunction): Chord;
  //   invert(): Chord;
  //   drop2(): Chord;
  //   drop3(): Chord;
  //   closed(): Chord;
}

export type ChordState = {
  name: string;
  root: PitchState;
  pitches: ChordPitchState[];
  pattern: string;
  bass: PitchState;
  lead: PitchState;
  duration: number;
};

class BaseChord implements Chord {
  protected pattern: ChordPattern;
  protected _pitches: ChordPitches;
  protected root: ChordPitch;
  protected duration: Duration;

  constructor(root: Pitch, pattern: ChordPattern, duration: Duration = Duration.Whole) {
    this.pattern = pattern;
    this._pitches = new ChordPitches(root, pattern);
    this.root = new ChordPitch(root, ChordFunction.Root);
    this.duration = duration;
  }

  get Pitches(): Pitch[] {
    return this._pitches.Pitches;
  }

  get Bass(): Pitch {
    return this._pitches.Bass;
  }

  get Lead(): Pitch {
    return this._pitches.Lead;
  }

  get Name(): string {
    return this.root.Pitch.Name + this.pattern.Name;
  }

  get Abbreviation(): string {
    return this.root.Pitch.Name + this.pattern.Abbreviation;
  }

  pitchForFunction(func: ChordFunction): Pitch {
    return this._pitches.pitchForFunction(func);
  }

  get To(): Readonly&lt;ChordState&gt; {
    return {
      name: this.Name,
      root: this.root.Pitch.To,
      pitches: this._pitches.To.map((p) =&gt; p),
      pattern: this.pattern.To,
      bass: this.Bass.To,
      lead: this.Lead.To,
      duration: this.duration.value,
    };
  }

  static From(state: ChordState): Chord | undefined {
    const root = Pitch.From(state.root);
    const pattern = ChordPattern.From(state.pattern);
    if (root === undefined || pattern === undefined) {
      return undefined;
    }
    return new BaseChord(root, pattern, Duration.From(state.duration));
  }
}

export class ClosedChord extends BaseChord {}

export class ChordFunction {
  private constructor(private name: string) {}

  public static readonly Root: ChordFunction = new ChordFunction(&#x27;Root&#x27;);
  public static readonly Third: ChordFunction = new ChordFunction(&#x27;Third&#x27;);
  public static readonly Fifth: ChordFunction = new ChordFunction(&#x27;Fifth&#x27;);
  public static readonly Sixth: ChordFunction = new ChordFunction(&#x27;Sixth&#x27;);
  public static readonly Seventh: ChordFunction = new ChordFunction(&#x27;Seventh&#x27;);
  public static readonly Ninth: ChordFunction = new ChordFunction(&#x27;Ninth&#x27;);
  public static readonly Eleventh: ChordFunction = new ChordFunction(&#x27;Eleventh&#x27;);
  public static readonly Thirteenth: ChordFunction = new ChordFunction(&#x27;Thirteenth&#x27;);

  public static functionForInterval(interval: Interval): ChordFunction {
    switch (interval) {
      case Interval.Unison:
        return ChordFunction.Root;
      case Interval.MajorThird:
      case Interval.MinorThird:
      case Interval.MajorSecond:
      case Interval.MinorSecond:
      case Interval.PerfectFourth:
      case Interval.AugmentedFourth:
        return ChordFunction.Third;
      case Interval.PerfectFifth:
      case Interval.DiminishedFifth:
      case Interval.AugmentedFifth:
        return ChordFunction.Fifth;
      case Interval.MinorSixth:
      case Interval.MajorSixth:
        return ChordFunction.Sixth;
      case Interval.MajorSeventh:
      case Interval.MinorSeventh:
      case Interval.DiminishedSeventh:
        return ChordFunction.Seventh;
      case Interval.MajorNinth:
      case Interval.MinorNinth:
        return ChordFunction.Ninth;
      case Interval.PerfectEleventh:
      case Interval.AugmentedEleventh:
        return ChordFunction.Eleventh;
      case Interval.MajorThirteenth:
        return ChordFunction.Thirteenth;
      default:
        return ChordFunction.Root;
    }
  }

  get To(): Readonly&lt;string&gt; {
    return this.name;
  }

  static From(name: string): ChordFunction | undefined {
    return ChordFunction.functions.find((f) =&gt; f.name === name);
  }

  static functions = [
    ChordFunction.Root,
    ChordFunction.Third,
    ChordFunction.Fifth,
    ChordFunction.Sixth,
    ChordFunction.Seventh,
    ChordFunction.Ninth,
    ChordFunction.Eleventh,
    ChordFunction.Thirteenth,
  ];
}

// Stryker disable StringLiteral
export class ChordPattern {
  private constructor(
    private name: string,
    private abbreviation: string,
    private pattern: Array&lt;Interval&gt;
  ) {}

  public static readonly Major: ChordPattern = new ChordPattern(&#x27;Major&#x27;, &#x27;Maj&#x27;, [
    Interval.MajorThird,
    Interval.PerfectFifth,
  ]);

  public static readonly Augmented: ChordPattern = new ChordPattern(&#x27;Augmented&#x27;, &#x27;Aug&#x27;, [
    Interval.MajorThird,
    Interval.AugmentedFifth,
  ]);
  public static readonly Major6: ChordPattern = new ChordPattern(&#x27;Major 6&#x27;, &#x27;Maj 6&#x27;, [
    Interval.MajorThird,
    Interval.PerfectFifth,
    Interval.MajorSixth,
  ]);
  public static readonly Major6Add9: ChordPattern = new ChordPattern(
    &#x27;Major 6 add 9&#x27;,
    &#x27;Maj 6 add 9&#x27;,
    [Interval.MajorThird, Interval.PerfectFifth, Interval.MajorSixth, Interval.MajorNinth]
  );
  public static readonly Major6Flat5Add9: ChordPattern = new ChordPattern(
    &#x27;Major 6 flat5 add 9&#x27;,
    &#x27;Maj 6 b5 add 9&#x27;,
    [Interval.MajorThird, Interval.DiminishedFifth, Interval.MajorSixth, Interval.MajorNinth]
  );
  public static readonly Major7: ChordPattern = new ChordPattern(&#x27;Major 7&#x27;, &#x27;Maj 7&#x27;, [
    Interval.MajorThird,
    Interval.PerfectFifth,
    Interval.MajorSeventh,
  ]);
  public static readonly Major9: ChordPattern = new ChordPattern(&#x27;Major 9&#x27;, &#x27;Maj 9&#x27;, [
    Interval.MajorThird,
    Interval.PerfectFifth,
    Interval.MajorSeventh,
    Interval.MajorNinth,
  ]);
  public static readonly Major9Sharp11: ChordPattern = new ChordPattern(
    &#x27;Major 9 sharp 11&#x27;,
    &#x27;Maj 9 #11&#x27;,
    [
      Interval.MajorThird,
      Interval.PerfectFifth,
      Interval.MajorSeventh,
      Interval.MajorNinth,
      Interval.AugmentedEleventh,
    ]
  );
  public static readonly Major11: ChordPattern = new ChordPattern(&#x27;Major 11&#x27;, &#x27;Maj 11&#x27;, [
    Interval.MajorThird,
    Interval.PerfectFifth,
    Interval.MajorSeventh,
    Interval.PerfectEleventh,
  ]);
  public static readonly Major13: ChordPattern = new ChordPattern(&#x27;Major 13&#x27;, &#x27;Maj 13&#x27;, [
    Interval.MajorThird,
    Interval.PerfectFifth,
    Interval.MajorSeventh,
    Interval.MajorThirteenth,
  ]);
  public static readonly Major13Sharp11: ChordPattern = new ChordPattern(
    &#x27;Major 13 sharp11&#x27;,
    &#x27;Maj 13 #11&#x27;,
    [
      Interval.MajorThird,
      Interval.PerfectFifth,
      Interval.MajorSeventh,
      Interval.AugmentedEleventh,
      Interval.MajorThirteenth,
    ]
  );
  public static readonly Augmented7: ChordPattern = new ChordPattern(&#x27;Augmented 7&#x27;, &#x27;Aug 7&#x27;, [
    Interval.MajorThird,
    Interval.AugmentedFifth,
    Interval.MajorSeventh,
  ]);
  public static readonly Dominant7: ChordPattern = new ChordPattern(&#x27;Dominant 7&#x27;, &#x27;7&#x27;, [
    Interval.MajorThird,
    Interval.PerfectFifth,
    Interval.MinorSeventh,
  ]);
  public static readonly Dominant7Flat5: ChordPattern = new ChordPattern(
    &#x27;Dominant 7 flat 5&#x27;,
    &#x27;7 b5&#x27;,
    [Interval.MajorThird, Interval.DiminishedFifth, Interval.MinorSeventh]
  );
  public static readonly Dominant7Flat9: ChordPattern = new ChordPattern(
    &#x27;Dominant 7 flat 9&#x27;,
    &#x27;7 b9&#x27;,
    [Interval.MajorThird, Interval.PerfectFifth, Interval.MinorSeventh, Interval.MinorNinth]
  );
  public static readonly Dominant7Sharp9: ChordPattern = new ChordPattern(
    &#x27;Dominant 7 sharp 9&#x27;,
    &#x27;7 #9&#x27;,
    [Interval.MajorThird, Interval.PerfectFifth, Interval.MinorSeventh, Interval.AugmentedNinth]
  );
  public static readonly Dominant7Flat5Flat9: ChordPattern = new ChordPattern(
    &#x27;Dominant 7 flat 5 flat9&#x27;,
    &#x27;7 b5 b9&#x27;,
    [Interval.MajorThird, Interval.DiminishedFifth, Interval.MinorSeventh, Interval.MinorNinth]
  );
  public static readonly Dominant7Flat5Sharp9: ChordPattern = new ChordPattern(
    &#x27;Dominant 7 flat 5 sharp9&#x27;,
    &#x27;7 b5 #9&#x27;,
    [Interval.MajorThird, Interval.DiminishedFifth, Interval.MinorSeventh, Interval.AugmentedNinth]
  );
  public static readonly Dominant9: ChordPattern = new ChordPattern(&#x27;Dominant 9&#x27;, &#x27;9&#x27;, [
    Interval.MajorThird,
    Interval.PerfectFifth,
    Interval.MinorSeventh,
    Interval.MajorNinth,
  ]);
  public static readonly Dominant11: ChordPattern = new ChordPattern(&#x27;Dominant 11&#x27;, &#x27;11&#x27;, [
    Interval.MajorThird,
    Interval.PerfectFifth,
    Interval.MinorSeventh,
    Interval.MajorNinth,
    Interval.PerfectEleventh,
  ]);
  public static readonly Dominant13: ChordPattern = new ChordPattern(&#x27;Dominant 13&#x27;, &#x27;13&#x27;, [
    Interval.MajorThird,
    Interval.PerfectFifth,
    Interval.MinorSeventh,
    Interval.MajorNinth,
    Interval.PerfectEleventh,
    Interval.MajorThirteenth,
  ]);
  public static readonly Minor: ChordPattern = new ChordPattern(&#x27;Minor&#x27;, &#x27;min&#x27;, [
    Interval.MinorThird,
    Interval.PerfectFifth,
  ]);
  public static readonly Diminished: ChordPattern = new ChordPattern(&#x27;Diminished&#x27;, &#x27;dim&#x27;, [
    Interval.MinorThird,
    Interval.DiminishedFifth,
  ]);
  public static readonly Minor7: ChordPattern = new ChordPattern(&#x27;Minor 7&#x27;, &#x27;min 7&#x27;, [
    Interval.MinorThird,
    Interval.PerfectFifth,
    Interval.MinorSeventh,
  ]);
  public static readonly Minor6: ChordPattern = new ChordPattern(&#x27;Minor 6&#x27;, &#x27;min 6&#x27;, [
    Interval.MinorThird,
    Interval.PerfectFifth,
    Interval.MajorSixth,
  ]);
  public static readonly Minor6Add9: ChordPattern = new ChordPattern(
    &#x27;Minor 6 add 9&#x27;,
    &#x27;min 6 add 9&#x27;,
    [Interval.MinorThird, Interval.PerfectFifth, Interval.MajorSixth, Interval.MajorNinth]
  );
  public static readonly Minor9: ChordPattern = new ChordPattern(&#x27;Minor 9&#x27;, &#x27;min 9&#x27;, [
    Interval.MinorThird,
    Interval.PerfectFifth,
    Interval.MinorSeventh,
    Interval.MajorNinth,
  ]);
  public static readonly Diminished7: ChordPattern = new ChordPattern(&#x27;Diminished7 &#x27;, &#x27;dim 7&#x27;, [
    Interval.MinorThird,
    Interval.DiminishedFifth,
    Interval.DiminishedSeventh,
  ]);
  public static readonly Minor7b5: ChordPattern = new ChordPattern(&#x27;Minor 7 b5&#x27;, &#x27;min 7 b5&#x27;, [
    Interval.MinorThird,
    Interval.DiminishedFifth,
    Interval.MinorSeventh,
  ]);
  public static readonly MinorMaj7: ChordPattern = new ChordPattern(&#x27;Minor Major 7&#x27;, &#x27;min Maj 7&#x27;, [
    Interval.MinorThird,
    Interval.PerfectFifth,
    Interval.MajorSeventh,
  ]);
  public static readonly MinorMaj9: ChordPattern = new ChordPattern(&#x27;Minor Major 9&#x27;, &#x27;min Maj 9&#x27;, [
    Interval.MinorThird,
    Interval.PerfectFifth,
    Interval.MajorSeventh,
    Interval.MajorNinth,
  ]);
  public static readonly Sus2: ChordPattern = new ChordPattern(&#x27;Su 2&#x27;, &#x27;Sus 2&#x27;, [
    Interval.MajorSecond,
    Interval.PerfectFifth,
  ]);
  public static readonly Sus2Diminished: ChordPattern = new ChordPattern(
    &#x27;Sus 2 diminished&#x27;,
    &#x27;Sus 2 dim&#x27;,
    [Interval.MajorSecond, Interval.DiminishedFifth]
  );
  public static readonly Sus2Augmented: ChordPattern = new ChordPattern(
    &#x27;Sus 2 Augmented&#x27;,
    &#x27;Sus 2 Aug&#x27;,
    [Interval.MajorSecond, Interval.AugmentedFifth]
  );
  public static readonly Sus4: ChordPattern = new ChordPattern(&#x27;Sus 4&#x27;, &#x27;Sus 4&#x27;, [
    Interval.PerfectFourth,
    Interval.PerfectFifth,
  ]);
  public static readonly Sus4Diminished: ChordPattern = new ChordPattern(
    &#x27;Sus 4 diminished&#x27;,
    &#x27;Sus 4 dim&#x27;,
    [Interval.PerfectFourth, Interval.DiminishedFifth]
  );
  public static readonly Sus4Augmented: ChordPattern = new ChordPattern(
    &#x27;Sus 4 Augmented&#x27;,
    &#x27;Sus 4 aug&#x27;,
    [Interval.PerfectFourth, Interval.AugmentedFifth]
  );

  pitches(root: Pitch): Array&lt;ChordPitch&gt; {
    return [new ChordPitch(root, ChordFunction.Root)].concat(
      this.pattern.map((p) =&gt; this.createChordNote(p, root))
    );
  }

  private createChordNote(interval: Interval, root: Pitch) {
    return new ChordPitch(root.transpose(interval), ChordFunction.functionForInterval(interval));
  }

  get Name() {
    return this.name;
  }

  get Abbreviation() {
    return this.abbreviation;
  }

  get To(): Readonly&lt;string&gt; {
    return this.Name;
  }

  static From(name: string): ChordPattern | undefined {
    return ChordPattern.patterns.find((n) =&gt; n.Name === name);
  }

  static readonly patterns = [
    ChordPattern.Major,
    ChordPattern.Augmented,
    ChordPattern.Major6,
    ChordPattern.Major6Add9,
    ChordPattern.Major6Flat5Add9,
    ChordPattern.Major7,
    ChordPattern.Major9,
    ChordPattern.Major9Sharp11,
    ChordPattern.Major11,
    ChordPattern.Major13,
    ChordPattern.Major13Sharp11,
    ChordPattern.Augmented7,
    ChordPattern.Dominant7,
    ChordPattern.Dominant7Flat5,
    ChordPattern.Dominant7Flat9,
    ChordPattern.Dominant7Sharp9,
    ChordPattern.Dominant7Flat5Flat9,
    ChordPattern.Dominant7Flat5Sharp9,
    ChordPattern.Dominant9,
    ChordPattern.Dominant11,
    ChordPattern.Dominant13,
    ChordPattern.Minor,
    ChordPattern.Diminished,
    ChordPattern.Minor7,
    ChordPattern.Minor6,
    ChordPattern.Minor6Add9,
    ChordPattern.Minor9,
    ChordPattern.Diminished7,
    ChordPattern.Minor7b5,
    ChordPattern.MinorMaj7,
    ChordPattern.MinorMaj9,
    ChordPattern.Sus2,
    ChordPattern.Sus2Diminished,
    ChordPattern.Sus2Augmented,
    ChordPattern.Sus4,
    ChordPattern.Sus4Diminished,
    ChordPattern.Sus4Augmented,
  ];

  public static readonly patternNames = ChordPattern.patterns.map((p) =&gt; p.To);
}
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Tue, 26 Apr 2022 16:36:14 GMT</p>
    </body>
  </html>
  